{"ast":null,"code":"import { File, Post } from \"../../../../models\";\n\nasync function addFile(id, name, owner) {\n  const addFile = await File.create({\n    postId: id,\n    name: name,\n    owner: owner\n  });\n  return addFile;\n}\n\nexport default (async (req, res) => {\n  if (req.method === \"POST\") {\n    const data = req.body;\n    const files = req.body.uploads;\n\n    if (data.id) {\n      try {\n        const post = await Post.findOne({\n          where: {\n            id: data.id,\n            owner: data.owner\n          }\n        });\n\n        if (!post) {\n          return res.status(404).send({\n            message: \"404 on post update\"\n          });\n        }\n\n        const updatedPost = await post.update({\n          title: data.title,\n          description: data.description,\n          //  userId: req.user.id,\n          catindex: data.catindex,\n          keyindex: data.keyindex,\n          country: data.country,\n          cities: data.city,\n          currency: data.currency,\n          price: data.price,\n          location: data.location,\n          owner: data.owner,\n          website: data.website,\n          twitter: data.twitter,\n          facebook: data.facebook,\n          status: data.status,\n          email: data.email,\n          phone: data.phone,\n          firstname: data.firstname,\n          lastname: data.lastname,\n          files: files\n        }, {\n          include: [{\n            model: File,\n            as: \"files\"\n          }]\n        });\n        files.map(async f => {\n          const file = await File.findOne({\n            where: {\n              name: f.name\n            }\n          });\n\n          if (!file) {\n            addFile(post.id, f.name, f.owner);\n          }\n        });\n        return res.status(200).send(updatedPost);\n      } catch (err) {\n        console.log(err);\n        return res.status(500).send(err);\n      }\n    } else {\n      var resultId = \"\";\n\n      try {\n        const post = await Post.create({\n          title: data.title,\n          description: data.description,\n          catindex: data.catindex,\n          keyindex: data.keyindex,\n          country: data.country,\n          age: data.age,\n          cities: data.cities,\n          //   currency: data.currency.value,\n          price: data.price,\n          location: data.location,\n          owner: data.owner,\n          website: data.website,\n          twitter: data.twitter,\n          facebook: data.facebook,\n          status: data.status,\n          email: data.email,\n          phone: data.phone,\n          firstname: data.firstname,\n          lastname: data.lastname,\n          status: \"Active\",\n          files: files\n        }, {\n          include: [{\n            model: File,\n            as: \"files\"\n          }]\n        });\n        return res.status(200).send(post);\n      } catch (err) {\n        console.log(err);\n        return res.status(500).send(err);\n      }\n    }\n  } else {\n    res.status(400).json({\n      message: \"Not Authorised\"\n    });\n  }\n});","map":null,"metadata":{},"sourceType":"module"}